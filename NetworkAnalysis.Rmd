---
title: "Network Analysis"
author: "Shara He"
date: "6/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages("brainGraph")
library(brainGraph)
library(igraph)
```

## Preparing Data

```{r}
# Read in data
load("~/Desktop/School/GatesLab/NetworkAnalysis/FullMatrices.Rdata")

# Preview all data
# View(outReg)
```

### Extract Submatrices for each Person
```{r}
submatrix = list()
for (x in 1:length(outReg)) {
  submatrix = append(submatrix, list(outReg[[x]][["regression_matrix"]][1:26,1:26]))
}

# Convert all submatrices into double type
feature_names = c("energetic", "enthusiastic", "content", "irritable", "restless", "worried", "guilty",  "afraid", "anhedonia", "angry","hopeless", "down", "positive", "fatigue", "tension", "concentrate", "accepted", "threatened", "ruminate", "avoid_act", "reassure", "procrast", "hours", "difficult", "unsatisfy", "avoid_people")
subdf = list()
for (x in 1:length(outReg)) {
  subdf[[x]] = matrix(unlist(submatrix[x]), ncol = 26, byrow = FALSE, dimnames = list(feature_names, feature_names))
}
subdf[[1]]
```

### Extract Directed Graphs for each Person
```{r}
dir_graph = list()
for(x in 1:length(outReg) ){
  dir_graph[[x]] = graph.adjacency(subdf[[x]], mode = "directed", weighted = TRUE)
}
dir_graph[[1]]
```

## Metrics for each Person
```{r}
density = list()
overall_weight = list()
variable_degrees = list() 
variable_strengths = list() 
for(x in 1:length(outReg)) {
  density[[x]] = edge_density(dir_graph[[x]], loops = FALSE)
  overall_weight[[x]] = sum(strength(dir_graph[[x]]))
  variable_degrees[[x]] = degree(dir_graph[[x]])
  variable_strengths[[x]] = strength(dir_graph[[x]])
  # Todo: Incude Global Efficiency and Betweenness Centrality measures.
}
print(paste0("Density of the first person's graph: ", round(density[[1]], 4)))
print(paste0("Overall Weight of the first person's graph: ", round(overall_weight[[1]], 4))) 
print("Degree of each variable in the first person's graph: ")
print(variable_degrees[[1]])
print("Strengths of each variable in the first person's graph: ")
print(variable_strengths[[1]])
```

```{r}
# Global Efficiency: may require postive weight vector
efficiency(dir_graph[[1]], type = c("global"), weights = NA,
  xfm = FALSE, xfm.type = NULL, use.parallel = TRUE, A = NULL,
  D = NULL)
```

```{r}
# Betweenness Centrality: Requires positive weight vector and potential cutoff range.
  # estimate_betweenness(dir_graph[[1]], cutoff=0, weights =edge_weights)
  # betweenness(dir_graph[[1]])
  # centr_betw(dir_graph[[1]])

# Edge Weight Attribute
edge_weights = edge_attr(dir_graph[[1]], "weight")
print("Edge Weights of the first person's graph: ")
print(edge_weights)
```

